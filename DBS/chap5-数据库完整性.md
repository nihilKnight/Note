# 数据库完整性

- [实体完整性](#实体完整性)
- [参照完整性](#参照完整性)
- [用户定义的完整性](#用户定义的完整性)
- [完整性约束命名子句](#完整性约束命名子句)
- [断言](#断言)
- [触发器](#触发器)

1. 数据库的完整性：（1）数据的**正确性**；（2）数据的**相容性**。
    - 为维护数据库的完整性，数据库管理系统必须：
        - 提供**定义**完整性约束的机制；
        - 提供完整性**检查**的方法；
        - **违约处理**；

## 实体完整性

2. 实体完整性检查和违约处理：
    - 检查**主码值是否唯一**，如果不唯一则拒绝插入或修改。
    - 检查**主码的各个属性是否为空**，只要有一个为空就拒绝插入或修改。

## 参照完整性

3. 可能破坏参照完整性的情况及违约处理：
    - **参照表插入元组**，若违约则**拒绝**；
    - **参照表修改外码值**，若违约则**拒绝**；
    - **被参照表删除元组**，若违约则**拒绝/级连删除/设置为空值**；
    - **被参照表修改主码值**，若违约则**拒绝/级连修改/设置为空值**。

## 用户定义的完整性

4. 完整性定义：
    - 定义**属性**上的约束条件：（1）列值非空（NOT NULL）；（2）列值唯一（UNIQUE）；（3）检查列值是否满足一个条件表达式（CHECK）。
    - 定义**元组**上的约束条件：设置不同属性之间取值的相互约束条件（CHECK）。
    - 违约处理：**拒绝执行**。

## 完整性约束命名子句

5. 完整性约束命名子句：CONSTRAINT<完整性约束条件名><完整性约束条件>
    - 修改：ALTER TBALE <表名> DROP/ADD CONSTRAINT <完整性约束条件名><完整性约束条件>。

## 断言

6. 断言：可以用于定义多个表的或聚集操作的较复杂的完整性约束。
    - 任何使断言**不为真值**的操作都会被**拒绝执行**。

## 触发器

7. 定义：
    ```
    CREATE TRIGGER <触发器名>
    {BEFORE|AFTER} <触发事件> [OF <列名>] ON <表名>
    REFERENCING NEW|OLD ROW AS <变量名>
    FOR EACH {ROW|STATEMENT}
    [WHEN <触发条件>] <触发动作体>
    ```
    - 表的**拥有者**才可在表上创建触发器。触发器名和表名**必须在统一模式**下。触发器只能定义在基本表上，不能定义在视图上。

8. 触发器类型：（1）**行级**触发器（触发动作每行执行一次）；（2）**语句级**触发器（触发动作只执行一次）。

9. 触发动作体：可以是**匿名PL/SQL过程块**，也可以是对已创建**存储过程**的调用。